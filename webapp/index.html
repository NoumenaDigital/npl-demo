<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello World App</title>
  </head>
  <body>
    <div id="app"></div>

    <!-- App structure template -->
    <template id="appTemplate">
      <div class="app-layout">
        <div class="split-container">
          <div id="codeContent" class="code-container"></div>
          <div class="app-panel" id="stepContainer">
            <!-- Content will be dynamically replaced based on current step -->
          </div>
        </div>
        <div id="responseContainer" class="response-container-wrapper"></div>
      </div>
    </template>

    <!-- Step 1: Greeting message template -->
    <template id="greetingTemplate">
      <div class="step-content">
        <h1>Hello World Protocol Demo</h1>
        <p>An illustration in 20 lines of how to build a secure application with NPL:</p>
        <ul class="feature-list">
          <li><strong>Secure</strong>: fine-grained access rights based on JWT</li>
          <li><strong>Simple & Convenient</strong>: generated endpoints and openAPI specs</li>
          <li><strong>Safety</strong>: persistence and transaction integrity ensured automatically</li>
        </ul>
        <div class="input-container">
          <button id="startDemoButton">Start Demo</button>
        </div>
      </div>
    </template>

    <!-- Step 2: Login screen template -->
    <template id="loginTemplate">
      <div class="step-content">
        <h1>Authentication</h1>
        <p>Login to access the Hello World Protocol API</p>
        <p>alice, bob and charlie are valid users for this demo. They share the same password.</p>
        <div class="form-container">
          <div class="form-group">
            <label for="usernameInput">Username:</label>
            <input type="text" id="usernameInput" value="alice">
          </div>
          <div class="form-group">
            <label for="passwordInput">Password:</label>
            <input type="password" id="passwordInput" value="password123">
          </div>
          <div class="input-container">
            <button id="loginButton">Login</button>
          </div>
        </div>
      </div>
    </template>

    <!-- Step 2.5: Logged-in screen template -->
    <template id="loggedInTemplate">
      <div class="step-content">
        <h1>You are logged in</h1>
        <p>Your attributes included in the authentication token (JWT)</p>
        <div id="logged-in-token-info"></div>
        <p>The token includes a preferred_username attribute, which is used to identify the user.</p>
        <div class="form-container">
          <div class="input-container">
            <button id="loggedInButton">Continue to Create Protocol</button>
          </div>
        </div>
      </div>
    </template>

    <!-- Step 3: Protocol creation template -->
    <template id="protocolTemplate">
      <div class="step-content">
        <h1>Create Protocol</h1>
        <p>Create a new instance of the Hello World protocol. It will live in the npl-demo app on NOUMENA Cloud. But you can also run it locally.</p>
        <p>Don't be scared, <button id="countButton" class="inline-button">n</button> people preceded you as <span id="usernameSpan"></span>!</p>
        <p>It uses the generated endpoint to instantiate a Hello World protocol. Your preferred_username will be bound to the innovator party to prevent access to everyone else.</p>
        <div class="input-container">
          <button id="createProtocolButton">Create Protocol</button>
        </div>
      </div>
    </template>

    <!-- Step 3.5: Created protocol template -->
    <template id="createdProtocolTemplate">
      <div class="step-content">
        <h1>Protocol created</h1>
        <p>Well done!</p>
        <p>The protocol is now ready for you. The protocol is in state greeting, ready for you and the sayHello action is available.</p>
        <p>The protocol's innovator party is bound to your preferred_username, so only you can access it.</p>
        <div class="input-container">
          <button id="createProtocolButton">Go to Say Hello</button>
        </div>
      </div>
    </template>

    <!-- Step 4: Say Hello template -->
    <template id="sayHelloTemplate">
      <div class="step-content">
        <h1>Call the permission</h1>
        <p>Are you ready for your first Hello World in NPL?</p>
        <p>The endpoint generated from the permission will allow you to say hello. But only you can, other users cannot access your Hello World protocol.</p>
        <div class="input-container">
          <button id="sayHelloButton">Say Hello</button>
        </div>
      </div>
    </template>

    <!-- Step 4.5: Said Hello template -->
    <template id="saidHelloTemplate">
      <div class="step-content">
        <h1>Success!</h1>
        <p>See below, you've done it! You are now part of the <a href="https://community.noumenadigital.com/">NOUMENA Community</a>!</p>
        <p>You have used most of the <a href="">NPL API</a> for this example. It comes out of the box when you <a href="/tracks/developing-NPL-local/">run the NOUMENA Runtime locally</a> and on <a href="https://portal.noumena.cloud/">NOUMENA Cloud</a>.</p>
        <div class="input-container">
          <button id="startAgainButton" class="again-button">Take me to the start</button>
        </div>
      </div>
    </template>

    <!-- Code content to display -->
    <template id="codeTemplate">
      <div class="code-header">
        <div class="code-title">demo/HelloWorld.npl</div>
      </div>
      <button class="code-copy-btn" onclick="copyCode()">Copy</button>
      <div class="code-content">
        <div class="code-line"><span class="line-number">1</span> <span class="line-code"><span class="keyword">package</span> demo;</span></div>
        <div class="code-line"><span class="line-number">2</span> <span class="line-code"></span></div>
        <div class="code-line"><span class="line-number">3</span> <span class="line-code"><span class="api-annotation">@api</span></span></div>
        <div class="code-line"><span class="line-number">4</span> <span class="line-code"><span class="keyword">protocol</span>[innovator] HelloWorld() {</span></div>
        <div class="code-line"><span class="line-number">5</span> <span class="line-code"></span></div>
        <div class="code-line"><span class="line-number">6</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">initial</span> <span class="keyword">state</span> greeting;</span></div>
        <div class="code-line"><span class="line-number">7</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">final</span> <span class="keyword">state</span> greeted;</span></div>
        <div class="code-line"><span class="line-number">8</span> <span class="line-code"></span></div>
        <div class="code-line"><span class="line-number">9</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span> <span class="keyword">var</span> <span class="function">validNames</span> = <span class="function">listOf</span>(<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="string">"Charlie"</span>);</span></div>
        <div class="code-line"><span class="line-number">10</span> <span class="line-code"></span></div>
        <div class="code-line"><span class="line-number">11</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;<span class="api-annotation">@api</span></span></div>
        <div class="code-line"><span class="line-number">12</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">permission</span>[innovator] <span class="function">sayHello</span>(name: Text) <span class="keyword">returns</span> Text | greeting {</span></div>
        <div class="code-line"><span class="line-number">13</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="function">require</span>(</span></div>
        <div class="code-line"><span class="line-number">14</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="function">validNames</span>.<span class="function">contains</span>(name),</span></div>
        <div class="code-line"><span class="line-number">15</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"Name must be part of the list of valid users"</span></span></div>
        <div class="code-line"><span class="line-number">16</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></div>
        <div class="code-line"><span class="line-number">17</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">become</span> greeted;</span></div>
        <div class="code-line"><span class="line-number">18</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="string">"Hello "</span> + name + <span class="string">"!"</span>;</span></div>
        <div class="code-line"><span class="line-number">19</span> <span class="line-code">&nbsp;&nbsp;&nbsp;&nbsp;};</span></div>
        <div class="code-line"><span class="line-number">20</span> <span class="line-code">};</span></div>
      </div>
    </template>

    <script type="module" src="/src/app.ts"></script>
    <script>
      function copyCode() {
        const codeLines = document.querySelectorAll('.line-code');
        let codeText = '';
        
        codeLines.forEach(line => {
          codeText += line.textContent + '\n';
        });
        
        navigator.clipboard.writeText(codeText).then(() => {
          const copyBtn = document.querySelector('.code-copy-btn');
          copyBtn.textContent = 'Copied!';
          setTimeout(() => {
            copyBtn.textContent = 'Copy';
          }, 2000);
        });
      }
    </script>
  </body>
</html>
