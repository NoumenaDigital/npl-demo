package demo;

@api
protocol[greeter] HelloWorld() {

    initial state greeting;
    final state greeted;

    @api
    permission[greeter] sayHello(greetee: Text) returns Text | greeting {
        become greeted;
        return "Hi " + greetee + ", " + getUsername(greeter) + " sends greetings!";
    };
};

function getUsername(party: Party) returns Text -> 
    party.claims()
    .getOrNone("preferred_username")
    .getOrFail()
    .toList()
    .get(0);
